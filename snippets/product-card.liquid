{% comment %}
  Enhanced Product Card Snippet
  Usage: {% render 'product-card', product: product, view_mode: 'grid' %}
{% endcomment %}

{% assign view_mode = view_mode | default: 'grid' %}

<div class="product-card group bg-white rounded-xl shadow-sm hover:shadow-lg transition-all duration-300 overflow-hidden h-full border border-gray-100">
  <!-- Product Image -->
  <div class="relative overflow-hidden aspect-square bg-gray-50">
    <a href="{{ product.url }}" class="block w-full h-full">
      {% if product.featured_image %}
        <img 
          src="{{ product.featured_image | img_url: '600x600' }}"
          alt="{{ product.featured_image.alt | default: product.title }}"
          class="w-full h-full object-cover transition-transform duration-300 group-hover:scale-105"
          loading="eager"
          width="600"
          height="600"
        >
      {% else %}
        <div class="w-full h-full flex items-center justify-center bg-gray-100">
          <svg class="w-16 h-16 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 002 2v12a2 2 0 002 2z"></path>
          </svg>
        </div>
      {% endif %}
    </a>
    
    <!-- Product Badges -->
    {% if product.compare_at_price > product.price %}
      <div class="absolute top-3 left-3 bg-red-500 text-white px-2 py-1 rounded-md text-xs font-medium">
        -{{ product.compare_at_price | minus: product.price | times: 100 | divided_by: product.compare_at_price }}%
      </div>
    {% endif %}
    
    <!-- Quick Actions Overlay -->
    <div class="absolute inset-0 bg-black/20 opacity-0 group-hover:opacity-100 transition-opacity flex items-center justify-center space-x-2">
      <!-- Quick Add -->
      {% if product.available %}
      <button 
        data-quick-add
        data-variant-id="{{ product.selected_or_first_available_variant.id }}"
        class="bg-white text-slate-800 p-2 rounded-full hover:bg-amber-50 hover:text-amber-600 transition-colors"
        title="Quick Add"
      >
        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 3h2l.4 2M7 13h10l4-8H5.4m2.6 8L6 21h12M9 19v2m4-2v2"></path>
        </svg>
      </button>
      {% endif %}
      
      <!-- Quick View -->
      <button 
        data-quick-view="{{ product.id }}"
        class="bg-white text-slate-800 p-2 rounded-full hover:bg-amber-50 hover:text-amber-600 transition-colors"
        title="Quick View"
      >
        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path>
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"></path>
        </svg>
      </button>
      
      <!-- Wishlist -->
      <button 
        data-wishlist="{{ product.id }}"
        class="bg-white text-slate-800 p-2 rounded-full hover:bg-amber-50 hover:text-red-500 transition-colors"
        title="Add to Wishlist"
      >
        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z"></path>
        </svg>
      </button>
    </div>
    
    <!-- Sale Badge -->
    {% if product.compare_at_price > product.price %}
    <div class="absolute top-3 left-3 bg-red-500 text-white px-2 py-1 rounded-full text-xs font-medium">
      {% assign discount = product.compare_at_price | minus: product.price | times: 100.0 | divided_by: product.compare_at_price | round %}
      -{{ discount }}%
    </div>
    {% endif %}
    
    <!-- Stock Badge -->
    {% unless product.available %}
    <div class="absolute top-3 right-3 bg-slate-500 text-white px-2 py-1 rounded-full text-xs font-medium">
      Sold Out
    </div>
    {% endunless %}
  </div>
  
  <!-- Product Info -->
  <div class="p-4 space-y-3">
    <!-- Vendor/Brand -->
    {% if product.vendor != blank %}
      <p class="text-xs text-gray-500 uppercase tracking-wide font-medium">{{ product.vendor }}</p>
    {% endif %}
    
    <!-- Title -->
    <h3 class="text-lg font-semibold text-gray-900 group-hover:text-blue-600 transition-colors line-clamp-2">
      <a href="{{ product.url }}">{{ product.title }}</a>
    </h3>
    
    <!-- Subtitle/Description -->
    {% if product.metafields.custom.subtitle %}
      <p class="text-sm text-gray-600 line-clamp-2">{{ product.metafields.custom.subtitle }}</p>
    {% elsif product.description != blank %}
      <p class="text-sm text-gray-600 line-clamp-2">{{ product.description | strip_html | truncate: 80 }}</p>
    {% endif %}
    
    <!-- Rating -->
    <div class="flex items-center space-x-1">
      {% for i in (1..5) %}
        <svg class="w-4 h-4 text-yellow-400" fill="currentColor" viewBox="0 0 24 24">
          <path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/>
        </svg>
      {% endfor %}
      <span class="text-sm text-gray-500">({{ settings.default_review_count | default: '4.8' }})</span>
    </div>
    
    <!-- Description (List view only) -->
    {% if view_mode == 'list' and product.description != blank %}
    <p class="text-slate-600 text-sm line-clamp-3">
      {{ product.description | strip_html | truncate: 150 }}
    </p>
    {% endif %}
    
    <!-- Price -->
    <div class="flex items-center justify-between">
      <div class="flex items-center space-x-2">
        {% if product.compare_at_price > product.price %}
          <span class="text-sm text-gray-400 line-through">{{ product.compare_at_price | money }}</span>
        {% endif %}
        <span class="text-lg font-bold text-gray-900">{{ product.price | money }}</span>
      </div>
    </div>
    
    <!-- View Product Button -->
    <div class="mt-3">
      {% if product.available %}
        <a href="{{ product.url }}" class="block w-full bg-yellow-400 hover:bg-yellow-500 text-gray-900 text-center py-2 px-4 rounded-lg font-medium transition-colors duration-200">
          View Product
        </a>
      {% else %}
        <button disabled class="block w-full bg-gray-200 text-gray-500 text-center py-2 px-4 rounded-lg font-medium cursor-not-allowed">
          Sold Out
        </button>
      {% endif %}
    </div>
    
    <!-- Variants Preview -->
    {% if product.options_with_values.size > 0 and view_mode == 'list' %}
    <div class="flex flex-wrap gap-1">
      {% assign color_option = product.options_with_values | where: 'name', 'Color' | first %}
      {% if color_option %}
        {% for value in color_option.values limit: 4 %}
        <div class="w-6 h-6 rounded-full border-2 border-slate-200" style="background-color: {{ value | downcase }}" title="{{ value }}"></div>
        {% endfor %}
      {% endif %}
    </div>
    {% endif %}
    
    <!-- Actions (List view only) -->
    {% if view_mode == 'list' %}
    <div class="flex items-center space-x-3 pt-2">
      {% if product.available %}
      <button 
        data-quick-add
        data-variant-id="{{ product.selected_or_first_available_variant.id }}"
        class="btn-premium flex-1"
      >
        Add to Cart
      </button>
      {% else %}
      <button class="btn-premium opacity-50 cursor-not-allowed flex-1" disabled>
        Sold Out
      </button>
      {% endif %}
      
      <button 
        data-wishlist="{{ product.id }}"
        class="btn-premium-outline p-2"
        title="Add to Wishlist"
      >
        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z"></path>
        </svg>
      </button>
    </div>
    {% endif %}
  </div>
</div>